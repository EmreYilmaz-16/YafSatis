function getCats(e){$.ajax({url:ServiceUri+"/ProductService.cfc?method=getCats",success:function(t){var n=JSON.parse(t);$(e).html("");for(let t=0;t<n.length;t++){var a=document.createElement("option");a.value=n[t].PRODUCT_CATID,a.innerText=n[t].PRODUCT_CAT,e.appendChild(a)}}})}function getCatProperties(e){AjaxPageLoad("index.cfm?fuseaction=objects.emptypopup_hrz_pbs_smartTools&ListType=catProps&PRODUCT_CATID="+e,"PROP_AREA",1,"Yükleniyor")}function AddEquipment(){var e=document.getElementById("PRODUCT_CAT"),t=e.options.selectedIndex,n=e.options[t].innerText,a=e.options[t].value,l={PRODUCT_CAT:n,PRODUCT_CAT_ID:a},d=[],r={PRODUCT_CAT:n,PRODUCT_CAT_ID:a,PNAME:"EQUIPMENT",PROP_ID:0,IS_OPTIONAL:0};d.push(r);var o=document.getElementsByClassName("propss"),i="";i+=a;var u=0;for(let e=0;e<o.length;e++){var m=o[e],_=m.getAttribute("required"),c=$(m).select2("data")[0],E=c.element.parentElement.getAttribute("data-property_id"),p=c.element.parentElement.getAttribute("data-is_optional");console.log(p);n=c.text,a=c.id;var s=c.title;if(c.id.length>0){var T={PRODUCT_CAT:n,PRODUCT_CAT_ID:a,PNAME:s,PROP_ID:E,IS_OPTIONAL:p};d.push(T),i+=","+a}"true"==_&&0==c.id.length&&u++}l.Filters=d,l.PropList=i;var I=JSON.stringify(l);if(console.log(l),u>0)return alert("Zorunlu Alanlar var !"),!1;addEqRow(l,I)}function addEqRow(e,t){var n=EqArr.findIndex(t=>t==e.PropList);if(-1!=n)return!1;var a=document.createElement("div");a.setAttribute("class","alert alert-success eq_header"),a.setAttribute("style","position:relative"),a.setAttribute("data-PropList",e.PropList);var l=document.createElement("table");l.setAttribute("class","EqTableMain");var d=document.createElement("tr"),r=document.createElement("td"),o=document.createElement("button");o.setAttribute("class","ui-wrk-btn");var i='<span class="icn-md icon-down"></span>';o.innerHTML=i,o.setAttribute("onclick","$('#SLO_'"+e.PropList+").toggle()");var u=document.createElement("button");u.setAttribute("class","ui-wrk-btn ui-wrk-btn-extra");i='<span class="icn-md fa fa-check-square-o"></span>';u.innerHTML=i;var m=document.createElement("button");m.setAttribute("class","ui-wrk-btn ui-wrk-btn-success");i='<span class="icn-md fa fa-plus"></span>';m.innerHTML=i,m.setAttribute("onclick","addRowCrs('"+e.PropList+"')");var _=document.createElement("button");_.setAttribute("class","ui-wrk-btn ui-wrk-btn-warning");i='<span class="icn-md fa fa-edit"></span>';_.innerHTML=i;var c=document.createElement("button");c.setAttribute("class","ui-wrk-btn ui-wrk-btn-red");i='<span class="icn-md icon-remove"></span>';c.setAttribute("onclick","SeciliSil('"+e.PropList+"')"),c.innerHTML=i;var E=document.createElement("button");E.setAttribute("class","ui-wrk-btn "),E.setAttribute("style","background:#292424 !important;color:white"),E.setAttribute("onclick","SeperatorSil('"+e.PropList+"')"),E.innerHTML='<span class="icn-md fa fa-trash"></span>';var p=document.createElement("button");p.setAttribute("class","ui-wrk-btn ui-wrk-btn-extra"),p.innerHTML='<span class="icn-md icon-filter"></span>',p.setAttribute("onclick","lookProducts('"+e.PropList+"')");var s=document.createElement("div");s.setAttribute("style","display:flex"),u.setAttribute("style","font-size: 7px !important;padding: 3px 7px !important;"),m.setAttribute("style","font-size: 7px !important;padding: 3px 7px !important;"),_.setAttribute("style","font-size: 7px !important;padding: 3px 7px !important;"),c.setAttribute("style","font-size: 7px !important;padding: 3px 7px !important;"),E.setAttribute("style","font-size: 7px !important;padding: 3px 7px !important;"),p.setAttribute("style","font-size: 7px !important;padding: 3px 7px !important;"),s.appendChild(u),s.appendChild(m),s.appendChild(_),s.appendChild(c),s.appendChild(E),s.appendChild(p),r.appendChild(s);var T=document.createElement("input");T.id="SeperatorRC_"+e.PropList,T.name="SeperatorRC_"+e.PropList,T.type="hidden",T.value=1,r.appendChild(T),d.appendChild(r);var I=8;for(let t=0;t<e.Filters.length;t++){const n=e.Filters[t];r=document.createElement("td");r.setAttribute("style","border-right:solid 1px;width:"+I+"%");var C="<span style='font-weight:bold'>"+n.PNAME+"</span></br><span>"+n.PRODUCT_CAT+"</span>";r.innerHTML=C,d.appendChild(r)}var A=0,O=0;if(e.Filters.length<12){A=12-e.Filters.length,O=8*A;r=document.createElement("td");r.setAttribute("style","width:"+O+"%"),d.appendChild(r)}l.appendChild(d);T=document.createElement("input");T.setAttribute("type","hidden"),T.value=t,T.name="AddedEquipment",T.id="AddedEquipment_"+e.PropList,a.appendChild(T),a.appendChild(l);var R=document.createElement("div");R.setAttribute("style","background:white"),R.setAttribute("id","SLO_"+e.PropList);var g=document.createElement("table");g.setAttribute("class","SubSepet table");var v=document.createElement("thead");d=document.createElement("tr");d.appendChild(thCrate("#")),d.appendChild(thCrate("Part No")),d.appendChild(thCrate("Part Name")),d.appendChild(thCrate("Quantity")),d.appendChild(thCrate("Unit")),d.appendChild(thCrate("Purchase Price")),d.appendChild(thCrate("Sales Price")),d.appendChild(thCrate("Sales Discount")),d.appendChild(thCrate("Unit Price")),d.appendChild(thCrate("Total Price")),d.appendChild(thCrate("First Remark")),d.appendChild(thCrate("Delivered Items")),d.appendChild(thCrate("Weight")),v.appendChild(d),g.appendChild(v),g.id="SubSepet_"+e.PropList;var D=document.createElement("tbody");D.id="SubSepetBody_"+e.PropList,g.appendChild(D),R.appendChild(g),a.appendChild(R);var S='<button class="ui-wrk-btn ui-wrk-btn-extra" style="position: absolute;right: 0;top: 0;"><span id="RC_'+e.PropList+'">0</span> Rows Listed<br><span id="TOTALE_'+e.PropList+'">0 '+OfferData.OTHER_MONEY+"</span></button>";S='<button class="ui-wrk-btn ui-wrk-btn-extra" style="position: absolute;right: 0;top: 0;"><span id="RC_'+e.PropList+'">0</span> Rows Listed<br><span id="TOTALE_'+e.PropList+'">0 '+OfferData.OTHER_MONEY+"</span></button>";S=$(S)[0],a.appendChild(S),document.getElementById("BasketArea").appendChild(a),EqArr.push(e.PropList)}function addRowCrs(e,t="",n="",a="",l,d="",r=1,o="",i=0,u="",m=0,_=0,c=0,E=0,p="",s=0,T=0,I=0,C=""){$("#SLO_"+e).show();var A=document.createElement("tr"),O=document.createElement("td"),R=document.createElement("input");R.type="checkbox",R.name="CBX",R.id="CBX_"+RowCount,R.setAttribute("class","SatirSecCbx");var g=document.createElement("input");g.type="hidden",g.name="IS_VIRTUAL",g.id="IS_VIRTUAL_"+RowCount,g.value=I;var v=document.createElement("input");v.type="hidden",v.name="UNIQUE_RELATION_ID",v.id="UNIQUE_RELATION_ID_"+RowCount,C.length>0?v.value=C:v.value=GenerateUniqueId();var D=document.createElement("button");D.setAttribute("class","ui-wrk-btn ui-wrk-btn-warning"),D.setAttribute("style","font-size: 7px !important;padding: 3px 7px !important;"),D.innerText=RowCount;var S=document.createElement("button");S.setAttribute("class","ui-wrk-btn ui-wrk-btn-success"),S.setAttribute("style","font-size: 7px !important;padding: 3px 7px !important;");var P=document.getElementById("SeperatorRC_"+e).value;P=parseInt(P),S.innerText=P,S.setAttribute("onclick","MoveRow("+P+")");var y=document.createElement("div");y.setAttribute("style","display:flex"),y.appendChild(R),y.appendChild(g),y.appendChild(v),y.appendChild(D),y.appendChild(S),P++,O.appendChild(y),A.appendChild(O),document.getElementById("SeperatorRC_"+e).value=P;O=document.createElement("td"),y=document.createElement("div");y.setAttribute("class","form-group");R=document.createElement("input");R.setAttribute("type","text"),R.name="PRODUCT_CODE_2",R.value=d,R.id="PRODUCT_CODE_2_"+RowCount,R.setAttribute("proplist",e),1==I?R.setAttribute("style","color:red;font-weight:bold;text-align:left;background:black;"):R.setAttribute("style","text-align:left"),R.setAttribute("onchange","getProduct(this,"+RowCount+")"),y.appendChild(R);R=document.createElement("input");R.type="hidden",R.name="PRODUCT_ID",R.id="PRODUCT_ID_"+RowCount,R.value=t,y.appendChild(R);R=document.createElement("input");R.type="hidden",R.name="STOCK_ID",R.id="STOCK_ID_"+RowCount,R.value=n,y.appendChild(R);R=document.createElement("input");R.type="hidden",R.name="TAX",R.value=l,R.id="TAX_"+RowCount,y.appendChild(R),O.appendChild(y),A.appendChild(O);O=document.createElement("td"),y=document.createElement("div");y.setAttribute("class","form-group");R=document.createElement("input");R.setAttribute("type","text"),R.name="PRODUCT_NAME",R.value=a,R.id="PRODUCT_NAME_"+RowCount,R.setAttribute("style","text-align:left"),y.appendChild(R),O.appendChild(y),A.appendChild(O);O=document.createElement("td"),y=document.createElement("div");y.setAttribute("class","form-group");R=document.createElement("input");R.setAttribute("type","text"),R.name="QUANTITY",R.id="QUANTITY_"+RowCount,R.value=commaSplit(r),R.setAttribute("onchange","AlayiniHesapla()"),y.appendChild(R),O.appendChild(y),A.appendChild(O);O=document.createElement("td"),y=document.createElement("div");y.setAttribute("class","form-group");R=document.createElement("select");var N=document.createElement("option");N.value=o,N.innerText=o,R.name="PRODUCT_UNIT",R.id="PRODUCT_UNIT_"+RowCount,R.appendChild(N),y.appendChild(R),O.appendChild(y),A.appendChild(O);O=document.createElement("td"),y=document.createElement("div");y.setAttribute("class","form-group");var b=document.createElement("div");b.setAttribute("class","input-group"),b.setAttribute("style","display:flex");R=document.createElement("input");R.setAttribute("type","text"),R.name="PURCHASE_PRICE",R.id="PURCHASE_PRICE_"+RowCount,R.value=commaSplit(i),b.appendChild(R);R=document.createElement("select");0==u.length&&(u=OfferData.OTHER_MONEY),R.innerHTML=CreateOptionList(1,u),R.name="PURCHASE_MONEY",R.id="PURCHASE_MONEY_"+RowCount,R.setAttribute("class","input-group-text"),b.appendChild(R),y.appendChild(b),O.appendChild(y),A.appendChild(O);O=document.createElement("td"),y=document.createElement("div");y.setAttribute("class","form-group");b=document.createElement("div");b.setAttribute("class","input-group"),b.setAttribute("style","display:flex");R=document.createElement("input");R.setAttribute("type","text"),R.name="SALE_PRICE",R.id="SALE_PRICE_"+RowCount,R.value=commaSplit(m),R.setAttribute("onchange","AlayiniHesapla()"),b.appendChild(R);R=document.createElement("select");R.innerHTML=CreateOptionList(1,OfferData.OTHER_MONEY),R.name="SALE_MONEY",R.id="SALE_MONEY_"+RowCount,R.setAttribute("disabled","yes"),R.setAttribute("class","input-group-text"),b.appendChild(R),y.appendChild(b),O.appendChild(y),A.appendChild(O);O=document.createElement("td"),y=document.createElement("div");y.setAttribute("class","form-group");b=document.createElement("div");b.setAttribute("class","input-group"),b.setAttribute("style","display:flex");R=document.createElement("input");R.setAttribute("type","text"),R.name="SALE_DISCOUNT",R.id="SALE_DISCOUNT_"+RowCount,R.value=commaSplit(_),R.setAttribute("onchange","AlayiniHesapla()"),b.appendChild(R);R=document.createElement("select");R.innerHTML=CreateOptionList(1,OfferData.OTHER_MONEY),R.name="SALE_DISCOUNT_MONEY",R.setAttribute("disabled","yes"),R.id="SALE_DISCOUNT_MONEY_"+RowCount,R.setAttribute("class","input-group-text"),b.appendChild(R),y.appendChild(b),O.appendChild(y),A.appendChild(O);O=document.createElement("td"),y=document.createElement("div");y.setAttribute("class","form-group");b=document.createElement("div");b.setAttribute("class","input-group"),b.setAttribute("style","display:flex");R=document.createElement("input");R.setAttribute("type","text"),R.name="UNIT_PRICE",R.id="UNIT_PRICE_"+RowCount,R.value=commaSplit(c),R.setAttribute("readonly","yes"),b.appendChild(R);R=document.createElement("select");R.innerHTML=CreateOptionList(1,OfferData.OTHER_MONEY),R.name="UNIT_PRICE_MONEY",R.id="UNIT_PRICE_MONEY_"+RowCount,R.setAttribute("class","input-group-text"),R.setAttribute("disabled","yes"),b.appendChild(R),y.appendChild(b),O.appendChild(y),A.appendChild(O);O=document.createElement("td"),y=document.createElement("div");y.setAttribute("class","form-group");b=document.createElement("div");b.setAttribute("class","input-group"),b.setAttribute("style","display:flex");R=document.createElement("input");R.setAttribute("type","text"),R.name="TOTAL_PRICE",R.id="TOTAL_PRICE_"+RowCount,R.setAttribute("readonly","yes"),R.value=commaSplit(E),b.appendChild(R);R=document.createElement("select");R.innerHTML=CreateOptionList(1,OfferData.OTHER_MONEY),R.name="TOTAL_PRICE_MONEY",R.id="TOTAL_PRICE_MONEY_"+RowCount,R.setAttribute("disabled","yes"),R.setAttribute("class","input-group-text"),b.appendChild(R),y.appendChild(b),O.appendChild(y),A.appendChild(O);O=document.createElement("td"),y=document.createElement("div");y.setAttribute("class","form-group");b=document.createElement("div");b.setAttribute("class","input-group"),b.setAttribute("style","display:flex");R=document.createElement("input");R.setAttribute("type","text"),R.name="FIRST_REMARK",R.value=p,R.id="FIRST_REMARK_"+RowCount,b.appendChild(R);R=document.createElement("span");R.setAttribute("class","input-group-addon btnPointer icon-remove"),b.appendChild(R),y.appendChild(b),O.appendChild(y),A.appendChild(O);O=document.createElement("td"),y=document.createElement("div");y.setAttribute("class","form-group");b=document.createElement("div");b.setAttribute("class","input-group"),b.setAttribute("style","display:flex");R=document.createElement("input");R.setAttribute("type","text"),R.name="DELIVERED_ITEMS",R.id="DELIVERED_ITEMS_"+RowCount,R.value=commaSplit(s),b.appendChild(R);R=document.createElement("select");R.innerHTML="",R.name="DELIVERED_ITEMS_UNIT",R.id="DELIVERED_ITEMS_UNIT_"+RowCount,R.setAttribute("class","input-group-text"),b.appendChild(R),y.appendChild(b),O.appendChild(y),A.appendChild(O);O=document.createElement("td"),y=document.createElement("div");y.setAttribute("class","form-group");b=document.createElement("div");b.setAttribute("class","input-group"),b.setAttribute("style","display:flex");R=document.createElement("input");R.setAttribute("type","text"),R.name="WEIGHT",R.id="WEIGHT_"+RowCount,R.value=commaSplit(T),b.appendChild(R);R=document.createElement("select");R.innerHTML="",R.name="WEIGHT_UNIT",R.id="WEIGHT_UNIT_"+RowCount,R.setAttribute("class","input-group-text"),b.appendChild(R),y.appendChild(b),O.appendChild(y),A.appendChild(O),document.getElementById("SubSepetBody_"+e).appendChild(A),RowCount++}function thCrate(e){var t=document.createElement("th");return t.innerText=e,t.setAttribute("class","tablesorter-header tablesorter-headerUnSorted"),t}function getProduct(e,t){var n=e.value,a=document.getElementById("PRODUCT_CODE_2_"+t).getAttribute("proplist"),l=document.getElementById("AddedEquipment_"+a).value;l=JSON.parse(l);var d={SearchMainValue:l,keyword:n};$.ajax({url:ServiceUri+"/ProductService.cfc?method=SearchProduct",data:{FormData:JSON.stringify(d)},success:function(n){var l=JSON.parse(n);if(l.RECORD_COUNT>=1){if(l.RECORD_COUNT>1){e.setAttribute("style","color:orange;font-weight:bold;text-align:left;");var d=document.createElement("button");d.setAttribute("class","btn btn-warning"),d.innerHTML="<i class='icn-md fa fa-search'></i>",e.parentElement.appendChild(d),e.parentElement.setAttribute("style","display:flex"),d.setAttribute("onclick","openBoxDraggable('index.cfm?fuseaction=objects.emptypopup_hrz_pbs_smartTools&ListType=getCollation&rc="+t+"&kw="+e.value+"&prp_list="+a+"')")}else if(l.EXTRA_PROPT>0){e.setAttribute("style","color:green;font-weight:bold;text-align:left;background:black");d=document.createElement("button");d.setAttribute("class","btn btn-success"),d.innerHTML="<i class='icn-md fa fa-search'></i>",e.parentElement.appendChild(d),e.parentElement.setAttribute("style","display:flex"),d.setAttribute("onclick","openBoxDraggable('index.cfm?fuseaction=objects.emptypopup_hrz_pbs_smartTools&ListType=ShowProductProperties&rc="+t+"&PID="+l.PRODUCT_ID+"&prp_list="+a+"')")}else e.setAttribute("style","color:green;font-weight:bold;text-align:left;");document.getElementById("PRODUCT_NAME_"+t).value=l.PRODUCT_NAME,document.getElementById("PRODUCT_ID_"+t).value=l.PRODUCT_ID,document.getElementById("IS_VIRTUAL_"+t).value=l.IS_VIRTUAL,document.getElementById("STOCK_ID_"+t).value=l.STOCK_ID,document.getElementById("TAX_"+t).value=l.TAX,document.getElementById("QUANTITY_"+t).value=commaSplit(1),document.getElementById("PRODUCT_UNIT_"+t).innerHTML='<option value="'+l.MAIN_UNIT+'">'+l.MAIN_UNIT+"</option>",document.getElementById("PURCHASE_PRICE_"+t).value=commaSplit(0),document.getElementById("SALE_PRICE_"+t).value=commaSplit(0),document.getElementById("SALE_DISCOUNT_"+t).value=commaSplit(0),document.getElementById("UNIT_PRICE_"+t).value=commaSplit(0),document.getElementById("TOTAL_PRICE_"+t).value=commaSplit(0),document.getElementById("DELIVERED_ITEMS_"+t).value=commaSplit(0),document.getElementById("DELIVERED_ITEMS_UNIT_"+t).innerHTML='<option value="'+l.MAIN_UNIT+'">'+l.MAIN_UNIT+"</option>",AlayiniHesapla(),document.getElementById("WEIGHT_"+t).value=commaSplit(0)}else{e.setAttribute("style","color:red;font-weight:bold;text-align:left;background:black"),document.getElementById("IS_VIRTUAL_"+t).value=1,document.getElementById("PRODUCT_ID_"+t).value=0,document.getElementById("STOCK_ID_"+t).value=0;var r=wrk_safe_query("getAllUnits","dsn");for(let e=0;e<r.recordcount;e++){var o=document.createElement("option");o.value=r.UNIT[e],o.innerText=r.UNIT[e],document.getElementById("PRODUCT_UNIT_"+t).appendChild(o)}}}})}function MoveRow(e){var t=prompt("To Row"),n=document.getElementById("STOCK_ID_"+e).value,a=document.getElementById("STOCK_ID_"+t).value,l=document.getElementById("PRODUCT_ID_"+e).value,d=document.getElementById("PRODUCT_ID_"+t).value,r=document.getElementById("PRODUCT_CODE_2_"+e).value,o=document.getElementById("PRODUCT_CODE_2_"+t).value,i=document.getElementById("TAX_"+e).value,u=document.getElementById("TAX_"+t).value,m=document.getElementById("PRODUCT_NAME_"+e).value,_=document.getElementById("PRODUCT_NAME_"+t).value,c=document.getElementById("QUANTITY_"+e).value,E=document.getElementById("QUANTITY_"+t).value,p=document.getElementById("PRODUCT_UNIT_"+e).value,s=document.getElementById("PRODUCT_UNIT_"+t).value,T=document.getElementById("PURCHASE_PRICE_"+e).value,I=document.getElementById("PURCHASE_PRICE_"+t).value,C=document.getElementById("PURCHASE_MONEY_"+e).value,A=document.getElementById("PURCHASE_MONEY_"+t).value,O=document.getElementById("SALE_PRICE_"+e).value,R=document.getElementById("SALE_PRICE_"+t).value,g=document.getElementById("SALE_MONEY_"+e).value,v=document.getElementById("SALE_MONEY_"+t).value,D=document.getElementById("SALE_DISCOUNT_"+e).value,S=document.getElementById("SALE_DISCOUNT_"+t).value,P=document.getElementById("SALE_DISCOUNT_MONEY_"+e).value,y=document.getElementById("SALE_DISCOUNT_MONEY_"+t).value,N=document.getElementById("UNIT_PRICE_"+e).value,b=document.getElementById("UNIT_PRICE_"+t).value,h=document.getElementById("UNIT_PRICE_MONEY_"+e).value,U=document.getElementById("UNIT_PRICE_MONEY_"+t).value,f=document.getElementById("TOTAL_PRICE_"+e).value,L=document.getElementById("TOTAL_PRICE_"+t).value,B=document.getElementById("TOTAL_PRICE_MONEY_"+e).value,w=document.getElementById("TOTAL_PRICE_MONEY_"+t).value,M=document.getElementById("FIRST_REMARK_"+e).value,x=document.getElementById("FIRST_REMARK_"+t).value,Y={FromRowData:{ROW_ID:e,STOCK_ID:n,PRODUCT_ID:l,PRODUCT_CODE:r,TAX:i,PRODUCT_NAME:m,QUANTITY:c,UNIT:p,PURCHASE_PRICE:T,PURCHASE_MONEY:C,SALE_PRICE:O,SALE_MONEY:g,SALE_DISCOUNT:D,SALE_DISCOUNT_MONEY:P,UNIT_PRICE:N,UNIT_PRICE_MONEY:h,TOTAL_PRICE:f,TOTAL_PRICE_MONEY:B,FIRST_REMARK:M},ToRowData:{ROW_ID:t,STOCK_ID:a,PRODUCT_ID:d,PRODUCT_CODE:o,TAX:u,PRODUCT_NAME:_,QUANTITY:E,UNIT:s,PURCHASE_PRICE:I,PURCHASE_MONEY:A,SALE_PRICE:R,SALE_MONEY:v,SALE_DISCOUNT:S,SALE_DISCOUNT_MONEY:y,UNIT_PRICE:b,UNIT_PRICE_MONEY:U,TOTAL_PRICE:L,TOTAL_PRICE_MONEY:w,FIRST_REMARK:x}};document.getElementById("STOCK_ID_"+e).value=Y.ToRowData.STOCK_ID,document.getElementById("STOCK_ID_"+t).value=Y.FromRowData.STOCK_ID,document.getElementById("PRODUCT_ID_"+e).value=Y.ToRowData.PRODUCT_ID,document.getElementById("PRODUCT_ID_"+t).value=Y.FromRowData.PRODUCT_ID,document.getElementById("PRODUCT_CODE_2_"+e).value=Y.ToRowData.PRODUCT_CODE,document.getElementById("PRODUCT_CODE_2_"+t).value=Y.FromRowData.PRODUCT_CODE,document.getElementById("TAX_"+e).value=Y.ToRowData.TAX,document.getElementById("TAX_"+t).value=Y.FromRowData.TAX,document.getElementById("PRODUCT_NAME_"+e).value=Y.ToRowData.PRODUCT_NAME,document.getElementById("PRODUCT_NAME_"+t).value=Y.FromRowData.PRODUCT_NAME,document.getElementById("QUANTITY_"+e).value=Y.ToRowData.QUANTITY,document.getElementById("QUANTITY_"+t).value=Y.FromRowData.QUANTITY,document.getElementById("PRODUCT_UNIT_"+e).value=Y.ToRowData.UNIT,document.getElementById("PRODUCT_UNIT_"+t).value=Y.FromRowData.UNIT,document.getElementById("PURCHASE_PRICE_"+e).value=Y.ToRowData.PURCHASE_PRICE,document.getElementById("PURCHASE_PRICE_"+t).value=Y.FromRowData.PURCHASE_PRICE,document.getElementById("PURCHASE_MONEY_"+e).value=Y.ToRowData.PURCHASE_MONEY,document.getElementById("PURCHASE_MONEY_"+t).value=Y.FromRowData.PURCHASE_MONEY,document.getElementById("SALE_PRICE_"+e).value=Y.ToRowData.SALE_PRICE,document.getElementById("SALE_PRICE_"+t).value=Y.FromRowData.SALE_PRICE,document.getElementById("SALE_MONEY_"+e).value=Y.ToRowData.SALE_MONEY,document.getElementById("SALE_MONEY_"+t).value=Y.FromRowData.SALE_MONEY,document.getElementById("SALE_DISCOUNT_"+e).value=Y.ToRowData.SALE_DISCOUNT,document.getElementById("SALE_DISCOUNT_"+t).value=Y.FromRowData.SALE_DISCOUNT,document.getElementById("SALE_DISCOUNT_MONEY_"+e).value=Y.ToRowData.SALE_DISCOUNT_MONEY,document.getElementById("SALE_DISCOUNT_MONEY_"+t).value=Y.FromRowData.SALE_DISCOUNT_MONEY,document.getElementById("UNIT_PRICE_"+e).value=Y.ToRowData.UNIT_PRICE,document.getElementById("UNIT_PRICE_"+t).value=Y.FromRowData.UNIT_PRICE,document.getElementById("UNIT_PRICE_MONEY_"+e).value=Y.ToRowData.UNIT_PRICE_MONEY,document.getElementById("UNIT_PRICE_MONEY_"+t).value=Y.FromRowData.UNIT_PRICE_MONEY,document.getElementById("TOTAL_PRICE_"+e).value=Y.ToRowData.TOTAL_PRICE,document.getElementById("TOTAL_PRICE_"+t).value=Y.FromRowData.TOTAL_PRICE,document.getElementById("TOTAL_PRICE_MONEY_"+e).value=Y.ToRowData.TOTAL_PRICE_MONEY,document.getElementById("TOTAL_PRICE_MONEY_"+t).value=Y.FromRowData.TOTAL_PRICE_MONEY,document.getElementById("FIRST_REMARK_"+e).value=Y.ToRowData.FIRST_REMARK,document.getElementById("FIRST_REMARK_"+t).value=Y.FromRowData.FIRST_REMARK,AlayiniHesapla()}function SeperatorSil(e="7,50014,50015"){var t=document.getElementById("BasketArea"),n=t.children;for(let t=0;t<n.length;t++){var a=n[t],l=a.getAttribute("data-proplist");l==e&&a.remove()}TumSatirlariDuzenle(),AlayiniHesapla()}function TumSatirlariDuzenle(){var e=1,t=document.getElementById("BasketArea"),n=t.children;for(let t=0;t<n.length;t++){var a=n[t],l=a.getAttribute("data-proplist"),d=document.getElementById("SubSepetBody_"+l).children;for(let t=0;t<d.length;t++){var r=d[t],o=r.getElementsByTagName("input"),i=r.getElementsByTagName("select"),u=r.getElementsByTagName("button");for(let t=0;t<o.length;t++){var m=o[t];m.id=m.name+"_"+e}for(let t=0;t<i.length;t++){m=i[t];m.id=m.name+"_"+e}for(let t=0;t<u.length;t++){m=u[t];var _=m.getAttribute("onclick");_||(m.innerText=e)}e++}}RowCount=e}function SeciliSil(e="7,50014,50015"){var t=document.getElementById("SubSepetBody_"+e).children;for(let e=0;e<t.length;e++){var n=t[e],a=$(n).find("input[type='checkbox']")[0];$(a).is(":checked")&&n.remove()}var l=0;t=document.getElementById("SubSepetBody_"+e).children;for(let e=0;e<t.length;e++){l++;var d=t[e],r=d.getElementsByTagName("button");console.log(r);for(let e=0;e<r.length;e++){var o=r[e],i=o.getAttribute("onclick");i&&(console.log("BTNATT="+i),o.innerText=l)}}0==l&&(l=1),document.getElementById("SeperatorRC_"+e).value=l,TumSatirlariDuzenle(),AlayiniHesapla()}function CreateOptionList(e,t="EUR"){if(1==e){var n=wrk_safe_query("getMoneyList","dsn"),a=n.MONEY,l="";for(let e=0;e<a.length;e++){const n=a[e];l+=t==n?"<option  selected value='"+n+"'>"+n+"</option>":"<option  value='"+n+"'>"+n+"</option>"}$("ReturnStr");return l}}function UpdateRow(e,t,n,a,l,d,r){document.getElementById("PRODUCT_ID_"+d).value=e,document.getElementById("TAX_"+d).value=n,document.getElementById("STOCK_ID_"+d).value=t,document.getElementById("PRODUCT_CODE_2_"+d).value=a,document.getElementById("PRODUCT_NAME_"+d).value=l,document.getElementById("PRODUCT_CODE_2_"+d).setAttribute("style","color:green;font-weight:bold;text-align:left;"),$(document.getElementById("PRODUCT_CODE_2_"+d).parentElement).find("button").remove(),closeBoxDraggable(r),AlayiniHesapla()}function AlayiniHesapla(){AktifSepet=[],OrderFooter={total_default:0,genel_indirim_:0,total_discount_wanted:0,brut_total_wanted:0,total_tax_wanted:0,net_total_wanted:0,other_money:"TL"};var e=document.getElementById("BasketArea").children;for(let H=0;H<e.length;H++){var t=e[H],n=t.getAttribute("data-proplist"),a=document.getElementById("AddedEquipment_"+n).value,l=JSON.parse(a),d=document.getElementById("SubSepetBody_"+n),r=0,o=d.children.length;document.getElementById("RC_"+n).innerText=o;var i=0,u=KurGetir(OfferData.OTHER_MONEY);for(let e=0;e<d.children.length;e++){var m=d.children[e];i++;var _=DegeriGetir(m,"PRODUCT_ID",1),c=DegeriGetir(m,"IS_VIRTUAL",1),E=DegeriGetir(m,"PRODUCT_NAME",0),p=DegeriGetir(m,"PRODUCT_CODE_2",0),s=0;0==OfferSettings.IS_TAX_ZERO&&(s=DegeriGetir(m,"TAX",2,0));var T=DegeriGetir(m,"STOCK_ID",1),I=DegeriGetir(m,"QUANTITY",2,1),C=DegeriGetir(m,"PRODUCT_UNIT",0),A=DegeriGetir(m,"PURCHASE_PRICE",2,1),O=DegeriGetir(m,"PURCHASE_MONEY",0),R=DegeriGetir(m,"SALE_PRICE",2,1),g=DegeriGetir(m,"SALE_MONEY",0),v=DegeriGetir(m,"SALE_DISCOUNT",2,1),D=DegeriGetir(m,"UNIQUE_RELATION_ID",0),S=DegeriGetir(m,"SALE_DISCOUNT_MONEY",0,0),P=DegeriGetir(m,"TOTAL_PRICE_MONEY",0,0),y=R-v;DegerYaz(m,"UNIT_PRICE",2,y);var N=0;if(u.MONEY==P)N=y*I;else{var b=MONEY_ARR.findIndex(e=>e.MONEY==P),h=MONEY_ARR[b],U=u.RATE2/h.RATE2;N=y*I*U}var f=R,L=R*u.RATE2;DegerYaz(m,"TOTAL_PRICE",2,N);var B=y*I*u.RATE2,w=B*s/100,M=B+w,x={PRODUCT_ID:_,STOCK_ID:T,PRODUCT_NAME:E,PRODUCT_CODE_2:p,AMOUNT:I,PRICE_OTHER:f,PRICE:L,OTHER_MONEY:OfferData.OTHER_MONEY,OTHER_MONEY_VALUE:N,DISCOUNT_COST:v,TL_TOTAL_PRICE:B,PRODUCT_UNIT:C,PURCHASE_PRICE:A,PURCHASE_MONEY:O,SALE_PRICE:R,SALE_PRICE:R,SALE_MONEY:g,IS_VIRTUAL:c,UNIQUE_RELATION_ID:D,SALE_DISCOUNT:v,PROP_LIST:n,JSON_STRINGIM:l,SALE_DISCOUNT_MONEY:S,UNIT_PRICE:y,TOTAL_PRICE:N,TOTAL_PRICE_MONEY:P,TAX_RATE:s,TAX:w,WITH_TAX:M,RATE2:u.RATE2,SEPET_SIRA:i};if(x.TLF=x.OTHER_MONEY_VALUE*u.RATE2,x.TOTAL_PRICE_MONEY==u.MONEY)r+=x.TOTAL_PRICE;else{var Y=MONEY_ARR.findIndex(e=>e.MONEY==x.TOTAL_PRICE_MONEY),F=MONEY_ARR[Y].RATE2;r+=x.TOTAL_PRICE*F}OrderFooter.total_default+=x.PRICE_OTHER*I,OrderFooter.total_discount_wanted+=x.PRICE_OTHER*x.AMOUNT-x.UNIT_PRICE*x.AMOUNT,AktifSepet.push(x)}document.getElementById("TOTALE_"+n).innerText=commaSplit(r),OrderFooter.TOTAL_PRICE+=r}var H=document.getElementById("genel_indirim_").value;H.length>0?(H=filterNum(commaSplit(H)),H=parseFloat(H),document.getElementById("genel_indirim_").value=commaSplit(H),OrderFooter.genel_indirim_=H):(document.getElementById("genel_indirim_").value=commaSplit(0),H=0,OrderFooter.genel_indirim_=H),OrderFooter.total_discount_wanted+=H,OrderFooter.brut_total_wanted=OrderFooter.total_default-OrderFooter.total_discount_wanted,OrderFooter.total_tax_wanted=0,OrderFooter.net_total_wanted=OrderFooter.total_default-OrderFooter.total_discount_wanted+OrderFooter.total_tax_wanted,OzetOlustur()}function GenerateUniqueId(){var e=new Date,t=e.toISOString().split("T")[0],n=e.toISOString().split("T")[1],a=t.replaceAll("-",""),l=n.replaceAll(":","");l=l.replaceAll(".",""),console.log(l);var d="PBS"+generalParamsSatis.userData.user_id+a+l;return d}function DegeriGetir(e,t,n=0,a=0){var l=$(e).find("input[name='"+t+"']").val(),d=0;if(l)0==n?d=l:1==n?d=parseInt(l):2==n&&(d=parseFloat(filterNum(commaSplit(l)))),1==a&&(2!=n&&1!=n||$(e).find("input[name='"+t+"']").val(commaSplit(d)));else{l=$(e).find("select[name='"+t+"']").val();0==n?d=l:1==n?d=parseInt(l):2==n&&(d=parseFloat(filterNum(commaSplit(l))))}return d}function DegerYaz(e,t,n=0,a){var l=$(e).find("input[name='"+t+"']")[0],d=0;l?0==n?d=a:1==n?d=commaSplit(a):2==n&&(d=commaSplit(a)):(l=$(e).find("select[name='"+t+"']")[0],0==n?d=a:1==n?d=parseInt(a):2==n&&(d=parseFloat(filterNum(commaSplit(a))))),$(l).val(d)}function KurGetir(e){var t=MONEY_ARR.findIndex(t=>t.MONEY==e);return MONEY_ARR[t]}function OzetOlustur(){var e="<ul>",t=document.getElementById("BasketArea").children;for(let i=0;i<t.length;i++){var n=t[i],a=$(n).find("table"),l=a[0].children[0].cells;e+="<li><table class='table'><tr><td>";var d=n.getAttribute("data-proplist"),r=document.getElementById("SubSepetBody_"+d);for(let t=0;t<l.length;t++){var o=l[t];try{e+=o.lastChild.innerText+"->"}catch{}}e+="</td><td> "+r.children.length+"</</td></tr></table></li>"}e+="</ul>",$("#OzetAlani").html(e);var i=KurGetir(OfferData.OTHER_MONEY);$("#brut_total_wanted").val(commaSplit(OrderFooter.brut_total_wanted)),$("#brut_total_wanted_").val(commaSplit(OrderFooter.brut_total_wanted*i.RATE2)),$("#genel_indirim_").val(commaSplit(OrderFooter.genel_indirim_)),$("#genel_indirim__").val(commaSplit(OrderFooter.genel_indirim_*i.RATE2)),$("#net_total_wanted").val(commaSplit(OrderFooter.net_total_wanted)),$("#net_total_wanted_").val(commaSplit(OrderFooter.net_total_wanted*i.RATE2)),$("#total_default").val(commaSplit(OrderFooter.total_default)),$("#total_default_").val(commaSplit(OrderFooter.total_default*i.RATE2)),$("#total_discount_wanted").val(commaSplit(OrderFooter.total_discount_wanted)),$("#total_discount_wanted_").val(commaSplit(OrderFooter.total_discount_wanted*i.RATE2)),$("#total_tax_wanted").val(commaSplit(OrderFooter.total_tax_wanted)),$("#total_tax_wanted_").val(commaSplit(OrderFooter.total_tax_wanted*i.RATE2)),OrderFooter.brut_total_wanted_=OrderFooter.brut_total_wanted*i.RATE2,OrderFooter.genel_indirim__=OrderFooter.genel_indirim_*i.RATE2,OrderFooter.net_total_wanted_=OrderFooter.net_total_wanted*i.RATE2,OrderFooter.total_default_=OrderFooter.total_default*i.RATE2,OrderFooter.total_discount_wanted_=OrderFooter.total_discount_wanted*i.RATE2,OrderFooter.total_tax_wanted_=OrderFooter.total_tax_wanted*i.RATE2}function lookProducts(e){openBoxDraggable("index.cfm?fuseaction=objects.emptypopup_list_products_pbs&proplist="+e)}function SaveOffer(){AlayiniHesapla();var e=new Object;e.OFFER_HEADER=OfferData,e.ROWS=AktifSepet,e.OFFER_FOOTER=OrderFooter,$.ajax({url:"/AddOns/YafSatis/Partner/cfc/OfferService.cfc?method=SAVE_OFFER_ROWS",data:{data:JSON.stringify(e)},success:function(e){$.notification(["Kayıt Edildi"],{messageType:"success"})}})}function get_consumer(e="",t=""){AjaxPageLoad("index.cfm?fuseaction=objects.emptypopup_get_company_partner&KEYWORD="+e.value,"text_cpm_search_result_area",1,"Yükleniyor")}function AddToCons(){var e=document.getElementsByName("comp_sel_cb"),t=document.getElementsByName("CBX");for(let C=0;C<e.length;C++){var n=e[C];if($(n).is(":checked")){var a=SelectedCompArr.findIndex(e=>e.COMPANY_ID==n.value),l=document.getElementById("comp_sel_mb_"+n.value).innerText,d=document.getElementById("comp_sel_nn_"+n.value).innerText;if(-1==a){var r={COMPANY_ID:n.value,NICKNAME:d,MEMBER_CODE:l,PIDS:[]};for(let e=0;e<=t.length;e++)try{var o=t[e];if($(o).is(":checked")){var i=document.getElementById("PRODUCT_ID_"+(e+1)).value,u=document.getElementById("STOCK_ID_"+(e+1)).value,m=document.getElementById("PRODUCT_NAME_"+(e+1)).value,_=document.getElementById("PRODUCT_CODE_2_"+(e+1)).value,c=document.getElementById("QUANTITY_"+(e+1)).value,E=document.getElementById("UNIQUE_RELATION_ID_"+(e+1)).value,p=document.getElementById("PRODUCT_UNIT_"+(e+1)).value,s={PID:i,SID:u,QUANTITY:filterNum(c),UNIQUE_RELATION_ID:E,PRODUCT_NAME:m,PRODUCT_CODE_2:_,PRODUCT_UNIT:p};r.PIDS.push(s)}}catch(e){}SelectedCompArr.push(r)
}else for(let e=0;e<=t.length;e++)try{o=t[e];var T="PRODUCT_ID_"+(e+1);console.log(T);i=document.getElementById("PRODUCT_ID_"+(e+1)).value,u=document.getElementById("STOCK_ID_"+(e+1)).value,m=document.getElementById("PRODUCT_NAME_"+(e+1)).value,_=document.getElementById("PRODUCT_CODE_2_"+(e+1)).value,c=document.getElementById("QUANTITY_"+(e+1)).value,E=document.getElementById("UNIQUE_RELATION_ID_"+(e+1)).value,p=document.getElementById("PRODUCT_UNIT_"+(e+1)).value;if($(o).is(":checked")){var I=SelectedCompArr[a].PIDS.findIndex(e=>e.UNIQUE_RELATION_ID==E);if(-1==I){s={PID:i,SID:u,QUANTITY:filterNum(c),UNIQUE_RELATION_ID:E,PRODUCT_NAME:m,PRODUCT_CODE_2:_,PRODUCT_UNIT:p};SelectedCompArr[a].PIDS.push(s)}}}catch(e){}}}TedarikYaz()}function TedarikYaz(){$("#tedarik").html("");for(let u=0;u<SelectedCompArr.length;u++){var e=SelectedCompArr[u];console.table(e);var t=document.createElement("table");t.setAttribute("class","table table-sm table-stripped"),t.setAttribute("style","border: solid 0.5px #d9d9d9;box-shadow: 1px 2px 20px 0px #cfc7c7;margin-top:5px !important;");var n=document.createElement("tr"),a=document.createElement("th");a.innerText=e.MEMBER_CODE,a.setAttribute("style","color:#fb6b5b;width:10%"),n.appendChild(a);a=document.createElement("th");a.innerText=e.NICKNAME;var l=document.createElement("span");l.innerText=e.PIDS.length,l.setAttribute("style","    float: right;margin-right: 10px;  background: #fb6b5b;  color: white;  padding: 1px 8px 1px 8px;  border-radius: 50%;"),a.setAttribute("style","color:#fb6b5b"),a.appendChild(l),n.appendChild(a),n.setAttribute("onclick","$('#tr_"+e.COMPANY_ID+"').toggle()"),t.appendChild(n);n=document.createElement("tr"),a=document.createElement("td");a.setAttribute("colspan","2");var d=document.createElement("table");d.setAttribute("class","table table-sm table-stripped");for(let t=0;t<e.PIDS.length;t++){var r=e.PIDS[t],o=document.createElement("tr"),i=document.createElement("td");i.innerText=r.PRODUCT_CODE_2,o.appendChild(i);i=document.createElement("td");i.innerText=r.PRODUCT_NAME,o.appendChild(i);i=document.createElement("td");i.innerText=r.QUANTITY,o.appendChild(i),d.appendChild(o)}a.appendChild(d),n.appendChild(a),n.setAttribute("style","display:none"),n.id="tr_"+e.COMPANY_ID,t.appendChild(n),document.getElementById("tedarik").appendChild(t)}}function AddPurchaseOffer(){var e=getParameterByName("offer_id"),t={OFFER_ID:e,FormData:SelectedCompArr};$.ajax({url:"/AddOns/YafSatis/Partner/cfc/OfferService.cfc?method=AddPurchaseOffer",data:{FormData:JSON.stringify(t)},success:function(e){}})}function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),a=n.exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}var RowCount=1,ServiceUri="/AddOns/YafSatis/Partner/cfc";$(document).ready(function(){var e=document.getElementById("PRODUCT_CAT");getCats(e),get_consumer("","")});var EqArr=[],AktifSepet=[],OfferSettings={IS_TAX_ZERO:1},OrderFooter={total_default:0,genel_indirim_:0,total_discount_wanted:0,brut_total_wanted:0,total_tax_wanted:0,net_total_wanted:0,other_money:"TL"},SelectedCompArr=[];